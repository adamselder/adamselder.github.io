
# Data Prep/Exclusions {#dataprep}

**FIGURE OUT HOW TO CACHE OR "MAKE" THIS - SO IT DOESN'T RERUN WHEN NOTHING HAS CHANGED**

```{r}
library(egonet)
data(nsfg.obj_c)
data(nsfg.obj_p)
data(nsfg.obj_i)

#------------------------------------------------------------
# SHAMP-SPECIFIC DATA PREP

# Quick and dirty construction of an alters matrix and the 
# corresponding egos matrix
#------------------------------------------------------------

# COHABS
temp <- lookup.ego(nsfg.obj_c, 'weight')
cohabs <- merge(data.frame(ego=temp$egoID,
			   weight=temp$var),
		nsfg.obj_c$alters)
cohabs$network <- 'Cohab'

# PERS
temp <- lookup.ego(nsfg.obj_p, 'weight')
pers <- merge(data.frame(ego=temp$egoID,
			   weight=temp$var),
		nsfg.obj_p$alters)
pers$network <- 'Persistent'

# ONETIME
temp <- lookup.ego(nsfg.obj_i, 'weight')
onetime <- merge(data.frame(ego=temp$egoID,
			   weight=temp$var),
		nsfg.obj_i$alters)
onetime$network <- 'One-Time'


# COMBINE 
alters <- rbind(cohabs, pers, onetime)
# Edge ID
alters$edge_id <- 1:nrow(alters)
# Create agecat
alters$agecat <- cut(alters$age, 
		     breaks=c(0,17,25,35,45,60), 
		     include.lowest=TRUE,
		     right=TRUE,
		     labels=c('0-17','18-25', '26-35', '36-45', '46-60'))
alters$edge_age_months <- alters$len
alters$edge_age_years <- alters$edge_age_months/12

# SAVE
saveRDS(alters, 'alters.rds')


# Now, construct the corresponding egos data frame using a quick merge
egos <- transform(nsfg.obj_c$egos,
		  deg.cohab.c=as.character(deg.cohab),
		  deg.pers.c=as.character(deg.pers))
egos4alters <- merge(egos, data.frame(ego=alters$ego,
				      edge_id=alters$edge_id), all.y=TRUE)
egos4alters <- egos4alters[order(egos4alters$edge_id),]

sum(egos4alters$edge_id!=alters$edge_id)

saveRDS(egos4alters, 'egos4alters.rds')
```

